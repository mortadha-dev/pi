{% extends 'base.html.twig' %}
{% block title %}SSC Checkout{% endblock %}

{% block body %}
<div class="nav-space-checkout">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <h1 class="checkout-header">Checkout</h1>
            </div>
            <div class="col-xs-18 col-sm-7">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="col-xs-6 active">Product</th>
                            <th class="col-xs-3 active text-center">Price</th>
                            <th class="col-xs-6 active text-center">Quantity</th>
                            <th class="col-xs-3 active text-center">Sum</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                            <tr class="product">
                                <th id="header" data="{{ product.id }}" class="col-xs-6 checkout-product-name">{{ product.name }}</th>
                                <td id="price" class="col-xs-3" data="{{ product.price }}">${{ product.price }}</td>
                                <td id="quantity" class="col-xs-6"><input onchange="updateAmount(this.value)" type="number" value="500" min="0" max="100" step="1"/></td>
                                <td id="sum" class="col-xs-3">$sum</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th class="col-xs-15 info" colspan="3">Total</th>

                            <td id="checkout-total" class="col-xs-3 info checkout-total">${{ cart.total }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="col-xs-12 col-sm-6">
                <!-- add checkout form here -->
                <div class="col-xs-12 col-sm-6">
                    <form action="" method="POST">
                        <script>
                            var amount = 0;
                            function calculateAmount() {
                                let total = 0;
                                $(".product").each(function (index) {
                                    let sum = 0;
                                   let price = $(this).children("#price").first().attr("data");
                                   let quant = $(this).children("#quantity").first().find("input").val();
                                   console.log(price+"=>"+quant);
                                   sum=price*quant;
                                   total+=sum;
                                   console.log(sum);
                                   $(this).children("#sum").first().text("$"+sum);
                                });
                                console.log("total=>"+total);
                                amount = total;
                                return total;
                            }
                            function setTotal(t) {
                                $("#checkout-total").text("$"+t);
                            }
                            function updateAmount(a){
                                setTotal(calculateAmount());


                            }

                            function save() {
                                let son = {}
                                $(".product").each(function (index) {
                                    let id = $(this).children("#header").first().attr("data");
                                    let quant = $(this).children("#quantity").first().find("input").val();
                                    son[id] = quant;
                                });
                                $.post("{{ path('vente_save_commande') }}", {"products":son }, function(result){
                                    console.log(result);
                                });
                            }

                        </script>
                        <script
                                src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                                data-key="{{ public_key }}"
                                data-amount=""+amount
                                data-name="Dollar Shear Club"
                                data-description="Widget"
                                data-image="{{ asset('backend/dist/img/avatar.png') }}"
                                data-locale="auto">
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block custom_scripts %}
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
    <script type="text/javascript">
        Stripe.setPublishableKey('{{  }}');
    </script>
{% endblock %}
